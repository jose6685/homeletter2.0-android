版本：20251002
產品：天父的信（Home Letter）
概述：以「天父」的溫柔口吻，根據使用者選擇或隨機主題，生成一封150–250字、具屬靈安慰與教導的家書，並附「三方向、兩經文、兩個行動呼籲」。使用者可保存、分享、朗讀與管理信件。

一、產品目標
- 提供即時、溫柔、具聖經真理的屬靈信件，陪伴不同處境的使用者。
- 降低使用門檻：一鍵抽卡、主題下拉選擇，15秒內獲得內容。
- 支援分享與保存，累積個人屬靈「信箱」。

二、成功指標（KPI）
- 生成成功率 ≥ 99%（有金鑰時）；無金鑰環境提供示範輸出。
- 平均生成延遲 ≤ 15秒（UI提示「天父花園的來信要等15秒左右. 期待一下!」）。
- 分享啟動率 ≥ 30%（Web Share/LINE/Facebook）。
- 保存率 ≥ 40%，信箱留存上限500筆。

三、使用者與場景
- 使用者：基督徒、慕道友、需要安慰/指引的人。
- 場景：
  - 快速抽卡：在壓力或煩悶時，希望即得安慰與方向。
  - 針對主題抽卡：選擇「工作/職場」「家庭/關係」「經濟/財富」等主題。
  - 分享關懷：將信件轉貼至LINE/Facebook、或口述朗讀。
  - 個人存檔：保存為檔案，或存入內建信箱以便回看。

四、核心功能與需求
1) 抽卡生成
- 隨機抽卡：按「抽一封」生成。
- 主題抽卡：下拉選擇主題後按「抽」。
- 主題清單（14項）：
  「工作 / 職場」「家庭 / 關係」「壓力 / 焦慮」「病痛 / 醫治」「供應 / 需要」
  「饒恕 / 和好」「方向 / 抉擇」「信心 / 盼望」「平安 / 安息」「感恩 / 敬拜」
  「經濟 / 財富」「出行 / 旅遊」「人際關係」「憂傷 / 煩悶」
- 生成長度：150–250字（家書風），語氣全程「溫柔鼓勵」。
- 結構要求：連貫家書（不可分段標號），自然融入三方向、兩經文與兩個行動呼籲。
- 輸出格式：純JSON物件（無```包裹），欄位固定：
  {"稱呼":"...","完整信件":"...","三方向":"...","兩經文":"...","兩個行動呼籱":"..."}

2) 顯示與互動
- 主視圖：
  - 信件內容區（letter-body），附「三方向/兩經文/行動」的附加資訊區（meta-inline）。
  - 底部操作列（letter-actions）：保存卡片、分享、LINE分享、Facebook分享、打開信箱。
  - 時段文案：依時間顯示四段動態文案（main.js: timeMessage）。
  - 朗讀：Web Speech API按鈕切換朗讀（優先朗讀生成內容）。
  - 顯示時鐘與跑馬燈：每秒更新。
- UI提示：
  - 等待提示：「天父花園的來信要等15秒左右. 期待一下!」
  - 分享失敗時提供剪貼簿備援。
- 美術背景：分層視差場景（天空、彩虹、河流、花園、向日葵、草葉、🕊️飛行），提升沉浸感。
- 透明度調整：
  - 卡片背景透明度：0.4。
  - 底部分享區背景透明度：0.4，含12px內距與圓角。

3) 信箱（mailbox）
- 列出、保存、刪除；依建立時間排序。
- 分頁：每頁6筆，顯示主題、日期、文字預覽（約90字）。
- Popover視窗：開啟/關閉、上一頁/下一頁、回到首頁。
- 上限：最多保留500筆；資料結構：
  { id, topic, text, directions, verses, actions, createdAt }

4) 分享與保存
- 保存：下載目前卡片內容。
- 分享：
  - Web Share API（瀏覽器支援時）。
  - LINE分享：開啟line分享URL或剪貼簿備援。
  - Facebook分享：開啟分享網址。

五、系統架構與部署
- 前端：Vercel（`frontend/`）；重寫規則將`/api/*`指向後端Render。
- 後端：Render（`backend/`，Express + OpenAI SDK）。
- 靜態預覽：本地以`python -m http.server 8000`預覽前端；後端`npm start`。
- 設定：`.env`（OPENAI_API_KEY、AI_MODEL、PORT）。

六、API與資料模型
- GET `/healthz`：健康檢查。
- GET `/api/topics`：回傳主題陣列（14項）。
- POST `/api/generate`：生成信件。
  Body：{ topic: string, nickname?: string }
  回應：{ ok, data }，`data`為JSON物件（見輸出格式）。
- 信箱：
  - GET `/api/mailbox`：{ ok, list }。
  - POST `/api/mailbox`：存入一筆；Body包含 { topic, text, directions, verses, actions, createdAt? }；回 { ok, id }。
  - DELETE `/api/mailbox/:id`：刪除。
- 資料結構：
  mailboxItem = { id: string, topic: string, text: string, directions?: string, verses?: string, actions?: string, createdAt: number }

七、非功能性需求（NFR）
- 性能：平均生成≤15秒；前端有loading與提示文案。
- 穩定性：無金鑰時提供示範輸出；後端錯誤時回`{ ok:false, error }`。
- 安全與隱私：不收集個人敏感資料；分享純文字；避免儲存敏感內容。
- 可及性：朗讀支援、按鈕尺寸與對比、語義化HTML。
- 相容性：Chrome/Edge/Firefox/Safari最新版本；行動裝置優化。
- 成本控制：使用`gpt-4o-mini`（或環境指定）。

八、版本紀錄（20251002）
- 新增主題：「經濟/財富」「出行/旅遊」「人際關係」「憂傷/煩悶」。
- 後端`/api/topics`與Prompt檔同步更新。
- UI提示改為「天父花園的來信要等15秒左右. 期待一下!」。
- 卡片與底部分享區透明度調整至0.4。

九、驗收測試（關鍵案例）
- 隨機/主題生成：送出後≤15秒獲得內容；JSON欄位齊全。
- 分享：Web Share可用；LINE/Facebook跳頁成功；失敗時剪貼簿備援。
- 保存：下載內容檔案成功。
- 信箱：新增/列表/分頁/刪除；最多500筆；時間排序正確。
- 無金鑰環境：能顯示示範輸出，不阻塞UI。
- 背景場景：載入流暢，視差效果不影響操作。

十、風險與緩解
- 生成品質波動：以提示詞說明書規範結構與語氣；必要時模型微調/溫度調整。
- 外部分享受限：提供剪貼簿備援與錯誤提示。
- 成本控制：限制最大token與重試策略；高峰時回退示範輸出。